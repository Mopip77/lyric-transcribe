<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyric Transcribe</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>

<body>
    <div class="container">
        <h1>Lyric Transcribe</h1>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab active" data-tab="merge" onclick="switchTab('merge')">音频合并</button>
            <button class="tab" data-tab="transcribe" onclick="switchTab('transcribe')">音频转录</button>
        </div>

        <!-- Merge Tab -->
        <div id="mergeTab" class="tab-content active">
            <!-- Merge Configuration -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">合并配置</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>源音频目录</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="mergeSourceDir" placeholder="/path/to/source">
                            <div class="autocomplete-dropdown" id="mergeSourceDirAutocomplete"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>输出目录</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="mergeOutputDir" placeholder="/path/to/output">
                            <div class="autocomplete-dropdown" id="mergeOutputDirAutocomplete"></div>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveMergeConfig()">保存配置</button>
                </div>
            </div>

            <!-- Merge File List -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">文件列表</span>
                    <button class="btn btn-secondary" onclick="scanMergeFiles()">扫描文件</button>
                </div>
                <div id="mergeFileListContainer">
                    <div class="empty-state">点击"扫描文件"加载文件列表</div>
                </div>
                <div class="btn-group" id="mergeFileActions" style="display: none;">
                    <div class="selection-actions">
                        <button class="btn-link" onclick="selectAllMerge()">全选</button>
                        <button class="btn-link" onclick="selectNoneMerge()">取消全选</button>
                        <button class="btn-link" onclick="selectInverseMerge()">反选</button>
                        <span id="mergeSelectionCount">已选择 0 个文件</span>
                    </div>
                    <div style="flex: 1;"></div>
                </div>
            </div>

            <!-- Merge Options -->
            <div class="section" id="mergeOptionsSection" style="display: none;">
                <div class="section-header">
                    <span class="section-title">合并选项</span>
                </div>
                <div class="merge-options">
                    <div class="form-group full-width">
                        <label>合并文件名</label>
                        <input type="text" id="mergeOutputName" value="merged_output.wav" placeholder="输出文件名">
                    </div>
                    <div class="merge-option">
                        <input type="checkbox" id="mergeDeleteSources">
                        <label for="mergeDeleteSources">合并完成后删除原文件</label>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="openMergeOrderModal()">调整顺序并合并</button>
                </div>
            </div>

            <!-- Merge Progress -->
            <div class="section" id="mergeProgressSection" style="display: none;">
                <div class="section-header">
                    <span class="section-title">合并进度</span>
                    <span class="elapsed-time" id="mergeElapsedTime"></span>
                </div>
                <div class="progress-header">
                    <span class="progress-text" id="mergeProgressText">准备中...</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="mergeProgressBar" style="width: 0%;"></div>
                </div>
                <div class="output-log" id="mergeOutputLog"></div>
            </div>
        </div>

        <!-- Transcribe Tab -->
        <div id="transcribeTab" class="tab-content">
            <!-- Transcribe Configuration -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">转录配置</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>源音频目录</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="sourceDir" placeholder="/path/to/source">
                            <div class="autocomplete-dropdown" id="sourceDirAutocomplete"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>歌词目录</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="lyricDir" placeholder="/path/to/lyrics">
                            <div class="autocomplete-dropdown" id="lyricDirAutocomplete"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>输出目录</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="outputDir" placeholder="/path/to/output">
                            <div class="autocomplete-dropdown" id="outputDirAutocomplete"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>封面图片路径</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="coverPath" placeholder="/path/to/cover.jpg">
                            <div class="autocomplete-dropdown" id="coverPathAutocomplete"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>模型</label>
                        <select id="model"></select>
                    </div>
                    <div class="form-group">
                        <label>语言</label>
                        <input type="text" id="language" value="zh">
                    </div>
                    <div class="form-group">
                        <label>歌手名</label>
                        <input type="text" id="singerName" placeholder="Artist Name">
                    </div>
                    <div class="form-group">
                        <label>专辑名</label>
                        <input type="text" id="albumName" placeholder="Album Name">
                    </div>
                    <div class="form-group full-width">
                        <label>Prompt</label>
                        <input type="text" id="prompt" value="歌词 简体中文" placeholder="Transcription prompt">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveConfig()">保存配置</button>
                </div>
            </div>

            <!-- Transcribe File List -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">文件列表</span>
                    <button class="btn btn-secondary" onclick="scanTranscribeFiles()">扫描文件</button>
                </div>
                <div id="transcribeFileListContainer">
                    <div class="empty-state">点击"扫描文件"加载文件列表</div>
                </div>
                <div class="btn-group" id="transcribeFileActions" style="display: none;">
                    <div class="selection-actions">
                        <button class="btn-link" onclick="selectAllTranscribe()">全选</button>
                        <button class="btn-link" onclick="selectNoneTranscribe()">取消全选</button>
                        <button class="btn-link" onclick="selectInverseTranscribe()">反选</button>
                        <span id="transcribeSelectionCount">已选择 0 个文件</span>
                    </div>
                    <div style="flex: 1;"></div>
                    <button class="btn btn-success" onclick="startTranscribeTask()"
                        id="transcribeStartBtn">开始处理</button>
                </div>
            </div>

            <!-- Transcribe Progress -->
            <div class="section" id="transcribeProgressSection" style="display: none;">
                <div class="section-header">
                    <span class="section-title">处理进度</span>
                    <span class="elapsed-time" id="transcribeElapsedTime"></span>
                    <button class="btn btn-danger btn-sm" onclick="cancelTranscribeTask()"
                        id="transcribeCancelBtn">取消</button>
                </div>
                <div class="progress-header">
                    <span class="progress-text" id="transcribeProgressText">准备中...</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="transcribeProgressBar" style="width: 0%;"></div>
                </div>
                <div class="output-log" id="transcribeOutputLog"></div>
            </div>
        </div>
    </div>

    <!-- Merge Order Modal -->
    <div class="modal" id="mergeOrderModal">
        <div class="modal-content">
            <div class="modal-header">调整音频合并顺序</div>
            <div class="modal-body">
                <p style="color: #666; margin-bottom: 15px;">拖拽文件以调整合并顺序</p>
                <div id="mergeOrderList"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('mergeOrderModal')">取消</button>
                <button class="btn btn-success" onclick="confirmMerge()">确认合并</button>
            </div>
        </div>
    </div>

    <!-- File Conflict Modal -->
    <div class="modal" id="fileConflictModal">
        <div class="modal-content">
            <div class="modal-header">文件已存在</div>
            <div class="modal-body confirm-dialog">
                <p>文件 <strong id="conflictFileName"></strong> 已存在，请选择操作：</p>
                <div class="btn-group">
                    <button class="btn btn-danger" id="overwriteBtn">覆盖</button>
                    <button class="btn btn-primary" id="renameBtn">重命名</button>
                    <button class="btn btn-secondary" id="cancelMergeBtn">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript modules -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/components/modal.js"></script>
    <script src="/static/js/components/autocomplete.js"></script>
    <script src="/static/js/transcribe-tab.js"></script>
    <script src="/static/js/merge-tab.js"></script>
    <script src="/static/js/app.js"></script>

    <script>
        // Show merge options section when files are selected
        document.addEventListener('DOMContentLoaded', () => {
            // Watch for selection changes to show/hide merge options
            const observer = new MutationObserver(() => {
                const count = getSelectedMergeFiles ? getSelectedMergeFiles().length : 0;
                const optionsSection = document.getElementById('mergeOptionsSection');
                if (count > 0) {
                    optionsSection.style.display = 'block';
                } else {
                    optionsSection.style.display = 'none';
                }
            });
            // This is a simple implementation - in production you'd want a better approach
        });
    </script>
</body>

</html>